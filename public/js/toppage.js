$(function(){$.ajaxSetup({headers:{'X-CSRF-Token':$('meta[name="_token"]').attr('content')}});$('#popup-content2').hide();$('body').on('click','.btn-form-login',function(){$('#popup-content').show();$('#popup-content2').hide();});$('body').on('click','.btn-form-register',function(){$('#popup-content').hide();$('#popup-content2').show();});$('body').on('click','.btn-login',function(){$.basicpopup({content:$('#popup-content').html()});return false;});$('body').on('click','.btn-register, .btn-sign-up',function(){$.basicpopup({content:$('#popup-content2').html()});return false;});$('.category_not_login:last').css('background','none');$('body').on('submit','.viblo-login-form',function(event){event.preventDefault();var form=$(this);var errorElement=$(this).parents('.form-content').find('.message-error');var formContent=$(this).parents('.form-content');$.ajax({type:'POST',url:baseURL+'/users/login',data:form.serialize(),dataType:'json',headers:{'X-XSRF-TOKEN':$("meta[name='csrf-token']").attr('content')},success:function(result){if(result.success){window.location.assign(result.url);}else{errorElement.empty();formContent.find('.error').empty();for(var key in result.messages){formContent.find('.'+key+'-error').empty().append('<p>'+replaceAttrMsg(result.messages[key])+'</p>');}if((result.activeEmailFlag==true)||(result.activeWorkEmailFlag==true)){errorElement.empty();$('.basicpopup-overlay, .basicpopup-outer').hide();var username=$('#txtUsername').val();var element=$('.viblo-login-form').parents('.form-content').find('.msg-error');var form=$('.viblo-login-form').parents('.form-content').find('.viblo-login-form');var flug=((result.activeEmailFlag==true))?'email':'work_email';swal({title:result.titleEmail,text:result.activeEmailMsg,type:'warning',showCancelButton:true,confirmButtonText:result.yesBtn,cancelButtonText:result.noBtn,closeOnConfirm:false,},function(isConfirm){if(isConfirm){$.ajax({type:'POST',url:baseURL+'/users/resendActiveEmail',data:{username:username,flug:flug},success:function(response){if(response.success){element.empty().append('<p class="resend-success">'+response.message+'<p>');}else{element.empty().append('<p>'+response.message+'<p>');}},error:function(response){element.empty().append('<p>'+errorMsg+'<p>');}});}$('.sweet-overlay, .sweet-alert').hide();$('.basicpopup-overlay, .basicpopup-outer').show();return false;});}}},error:function(){formContent.find('.error').empty();errorElement.empty().append('<p>'+errorMsg+'</p>');}});});$('body').on('submit','.viblo-signup-form',function(event){event.preventDefault();var form=$(this);var tos=$(this).parents('.form-content').find('.tos-check');var errorElement=$(this).parents('.form-content').find('.message-error');var formContent=$(this).parents('.form-content');if(tos.is(':checked')){$.ajax({type:'POST',url:baseURL+'/users/signup',data:form.serialize(),dataType:'json',success:function(result){if(result.success){window.location.assign(result.url);}else{errorElement.empty();formContent.find('.error').empty();for(var key in result.messages){formContent.find('.'+key+'-error').empty().append('<p>'+replaceAttrMsg(result.messages[key])+'</p>');}}},error:function(){formContent.find('.error').empty();errorElement.empty().append('<p>'+errorMsg+'</p>');}});}else{errorElement.empty().append('<p>'+agreeWithTerms+'</p>');}});$('#system-language-top-not-auth').change(function(e){var type=null,systemLang=$(this).val(),url=baseURL+'/'+systemLang;window.location.href=url;});$('.video-thumb').click(function(e){$('#popup-video').show();toggleVideo();$('body').on('click','.popup-video-content, .popup-video-inner, .popup-video-btn-close',function(elem){if($(elem.target).is(this)){$('#popup-video').hide();toggleVideo('hide');}});function toggleVideo(state){var iframeElement=$('#popup-video').find('iframe'),iframe=iframeElement.length?iframeElement[0].contentWindow:null,func=state=='hide'?'pauseVideo':'playVideo';if(iframe){iframe.postMessage('{"event":"command","func":"'+func+'","args":""}','*');};}});$('body').on('click','.resend-active-email',function(){var element=$(this).parents('.form-content').find('.msg-error');var form=$(this).parents('.form-content').find('.viblo-login-form');$.ajax({type:'POST',url:baseURL+'/users/resendActiveEmail',data:form.serialize(),success:function(response){if(response.success){element.empty().append('<p class="resend-success">'+response.message+'<p>');}else{element.empty().append('<p>'+errorMsg+'<p>');}},error:function(response){element.empty().append('<p>'+errorMsg+'<p>');}});});});function replaceAttrMsg(message){var result=message;if($.isArray(message)){result=message[0];}var attrArr=['username','name','email','password confirmation','password'];var labelsArr={'username':userNameLabel,'name':nameLabel,'email':emailLabel,'password':passwordLabel,'password confirmation':confirmPwdLabel};for(var i=0;i<attrArr.length;i++){result=result.replace(attrArr[i],labelsArr[attrArr[i]]);}return result;}